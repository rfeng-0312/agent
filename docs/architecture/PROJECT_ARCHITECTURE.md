# ğŸ“š é¡¹ç›®æ¶æ„è¯¦è§£ - åä¾¦æ¢ä½œä¸šå¸®

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºFlaskåç«¯å’ŒåŸç”ŸJavaScriptå‰ç«¯çš„Webåº”ç”¨ï¼Œä¸“é—¨ç”¨äºè§£ç­”ç‰©ç†å’ŒåŒ–å­¦é—®é¢˜ã€‚å®ƒä½¿ç”¨DeepSeek APIæ¥æä¾›æ™ºèƒ½è§£ç­”ï¼Œå¹¶å±•ç¤ºAIçš„æ€è€ƒè¿‡ç¨‹ã€‚

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
new_agent/
â”œâ”€â”€ åç«¯éƒ¨åˆ† (Flask)
â”‚   â”œâ”€â”€ app.py              # ä¸»åº”ç”¨æ–‡ä»¶ - Flaskåç«¯æœåŠ¡å™¨
â”‚   â”œâ”€â”€ prompts.py          # Promptæ¨¡æ¿ - ä¸åŒç§‘ç›®çš„æç¤ºè¯
â”‚   â”œâ”€â”€ requirements.txt    # Pythonä¾èµ–åŒ…åˆ—è¡¨
â”‚   â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆAPIå¯†é’¥ç­‰ï¼‰
â”‚   â””â”€â”€ .env.example       # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚
â”œâ”€â”€ å‰ç«¯éƒ¨åˆ†
â”‚   â”œâ”€â”€ templates/          # HTMLæ¨¡æ¿æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ test.html      # ä¸»é¡µé¢ - ç”¨æˆ·è¾“å…¥ç•Œé¢
â”‚   â”‚   â””â”€â”€ result.html    # ç»“æœé¡µé¢ - å±•ç¤ºAIè§£ç­”
â”‚   â”‚
â”‚   â””â”€â”€ static/            # é™æ€èµ„æº
â”‚       â”œâ”€â”€ script.js      # JavaScriptä¸»é€»è¾‘
â”‚       â”œâ”€â”€ styles.css     # CSSæ ·å¼æ–‡ä»¶
â”‚       â””â”€â”€ *.jpg          # å›¾ç‰‡èµ„æº
â”‚
â”œâ”€â”€ æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ uploads/           # ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡
â”‚   â””â”€â”€ sessions/          # ä¼šè¯æ•°æ®ï¼ˆä¸´æ—¶å­˜å‚¨ï¼‰
â”‚
â””â”€â”€ å…¶ä»–æ–‡ä»¶
    â”œâ”€â”€ run.py             # å¯åŠ¨è„šæœ¬
    â”œâ”€â”€ install_all.py     # è‡ªåŠ¨å®‰è£…ä¾èµ–è„šæœ¬
    â”œâ”€â”€ deploy.py          # éƒ¨ç½²è„šæœ¬
    â”œâ”€â”€ DEPLOYMENT.md      # éƒ¨ç½²æ–‡æ¡£
    â””â”€â”€ CLAUDE.md         # å¼€å‘æŒ‡å—
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„ï¼ˆFlaskï¼‰

```
ç”¨æˆ·è¯·æ±‚ â†’ Flaskè·¯ç”± â†’ å¤„ç†é€»è¾‘ â†’ è°ƒç”¨DeepSeek API â†’ è¿”å›å“åº”
```

#### ä¸»è¦ç»„ä»¶ï¼š

1. **app.py - Flaskåº”ç”¨æ ¸å¿ƒ**
   - è·¯ç”±å®šä¹‰ï¼šå¤„ç†ä¸åŒçš„URLè¯·æ±‚
   - APIæ¥å£ï¼š`/api/query/text`ã€`/api/stream/<session_id>`
   - CORSé…ç½®ï¼šå…è®¸å‰ç«¯è·¨åŸŸè¯·æ±‚
   - ä¼šè¯ç®¡ç†ï¼šä¸´æ—¶å­˜å‚¨é—®ç­”æ•°æ®

2. **prompts.py - æç¤ºè¯ç®¡ç†**
   - ç‰©ç†é—®é¢˜ä¸“ç”¨Prompt
   - åŒ–å­¦é—®é¢˜ä¸“ç”¨Prompt
   - æ ¹æ®ç§‘ç›®åŠ¨æ€é€‰æ‹©åˆé€‚çš„æç¤ºè¯

### å‰ç«¯æ¶æ„ï¼ˆåŸç”ŸJavaScriptï¼‰

```
ç”¨æˆ·ç•Œé¢ â†’ JavaScriptäº‹ä»¶ â†’ APIè°ƒç”¨ â†’ å¤„ç†å“åº” â†’ æ›´æ–°ç•Œé¢
```

#### ä¸»è¦ç»„ä»¶ï¼š

1. **HTMLç»“æ„ (templates/)**
   - `test.html`ï¼šä¸»é¡µé¢ï¼ŒåŒ…å«é—®é¢˜è¾“å…¥è¡¨å•
   - `result.html`ï¼šç»“æœé¡µé¢ï¼Œä½¿ç”¨Server-Sent Eventsæµå¼æ˜¾ç¤ºç­”æ¡ˆ

2. **JavaScripté€»è¾‘ (static/script.js)**
   - DOMæ“ä½œï¼šå¤„ç†ç”¨æˆ·äº¤äº’
   - APIé€šä¿¡ï¼šä½¿ç”¨fetchå‘é€è¯·æ±‚
   - æµå¼æ¥æ”¶ï¼šEventSourceæ¥æ”¶æµå¼æ•°æ®
   - åŠ¨ç”»æ•ˆæœï¼šç²’å­ç³»ç»Ÿã€ä¸»é¢˜åˆ‡æ¢ç­‰

3. **CSSæ ·å¼ (static/styles.css)**
   - å“åº”å¼è®¾è®¡ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
   - ä¸»é¢˜ç³»ç»Ÿï¼šç‰©ç†(è“è‰²)ã€åŒ–å­¦(çº¢è‰²)
   - åŠ¨ç”»æ•ˆæœï¼šCSSåŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ

## ğŸ”„ å·¥ä½œæµç¨‹è¯¦è§£

### 1. ç”¨æˆ·æäº¤æµç¨‹

```
ç”¨æˆ·è¾“å…¥é—®é¢˜ â†’ ç‚¹å‡»æäº¤ â†’ JavaScriptå¤„ç† â†’ å‘é€APIè¯·æ±‚
```

#### JavaScriptç«¯ï¼ˆscript.jsï¼‰ï¼š
```javascript
// 1. è·å–ç”¨æˆ·è¾“å…¥
const questionText = document.getElementById('problemInput').value.trim();
const currentSubject = getSelectedSubject(); // physics æˆ– chemistry

// 2. å‘é€åˆ°åç«¯
const response = await fetch('/api/query/text', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        question: questionText,
        subject: currentSubject
    })
});
```

#### Flaskç«¯ï¼ˆapp.pyï¼‰ï¼š
```python
# 1. æ¥æ”¶è¯·æ±‚
@app.route('/api/query/text', methods=['POST'])
def handle_text_query():
    data = request.get_json()
    question = data['question']
    subject = data['subject']

    # 2. ç”Ÿæˆä¼šè¯IDå¹¶å­˜å‚¨
    session_id = generate_session_id()
    save_session_data(session_id, question, subject)

    # 3. è¿”å›ä¼šè¯ä¿¡æ¯ç»™å‰ç«¯
    return jsonify({
        'session_id': session_id,
        'redirect_url': f'/result/{session_id}'
    })
```

### 2. AIè§£ç­”æµç¨‹

```
è·å–ä¼šè¯ID â†’ è·³è½¬ç»“æœé¡µ â†’ å»ºç«‹SSEè¿æ¥ â†’ æµå¼æ¥æ”¶æ•°æ®
```

#### ç»“æœé¡µé¢ï¼ˆresult.htmlï¼‰ï¼š
```javascript
// 1. å»ºç«‹EventSourceè¿æ¥
const eventSource = new EventSource(`/api/stream/${sessionId}`);

// 2. æ¥æ”¶ä¸åŒç±»å‹çš„æ•°æ®
eventSource.onmessage = function(event) {
    const data = JSON.parse(event.data);

    switch(data.type) {
        case 'thinking':  // AIæ€è€ƒè¿‡ç¨‹
            displayThinking(data.content);
            break;
        case 'answer':    // æœ€ç»ˆç­”æ¡ˆ
            displayAnswer(data.content);
            break;
        case 'done':      // å®Œæˆä¿¡å·
            eventSource.close();
            break;
    }
};
```

#### Flaskæµå¼å“åº”ï¼š
```python
@app.route('/api/stream/<session_id>')
def stream_response():
    # 1. åŠ è½½ä¼šè¯æ•°æ®
    session_data = load_session(session_id)

    # 2. è°ƒç”¨DeepSeek API
    stream = client.chat.completions.create(
        model="deepseek-reasoner",
        messages=build_messages(session_data),
        stream=True,
        extra_body={"thinking": {"type": "enabled"}}
    )

    # 3. æµå¼è¿”å›æ•°æ®
    for chunk in stream:
        if chunk.reasoning_content:
            yield f"data: {json.dumps({'type': 'thinking', 'content': chunk.reasoning_content})}\n\n"
        if chunk.content:
            yield f"data: {json.dumps({'type': 'answer', 'content': chunk.content})}\n\n"
```

## ğŸ¨ å‰ç«¯æ¶æ„ç»†èŠ‚

### DOMç»“æ„è®¾è®¡

```html
ä¸»é¡µé¢ (test.html)
â”œâ”€â”€ å¯¼èˆªæ 
â”œâ”€â”€ ä¸»é¢˜åˆ‡æ¢æ ‡ç­¾
â”‚   â”œâ”€â”€ ç‰©ç†æŒ‰é’® (btnPhysics)
â”‚   â””â”€â”€ åŒ–å­¦æŒ‰é’® (btnChemistry)
â”œâ”€â”€ è¾“å…¥åŒºåŸŸ
â”‚   â”œâ”€â”€ é—®é¢˜è¾“å…¥æ¡† (problemInput)
â”‚   â”œâ”€â”€ å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ
â”‚   â””â”€â”€ æäº¤æŒ‰é’® (submitBtn)
â””â”€â”€ åŠ¨ç”»èƒŒæ™¯
    â”œâ”€â”€ æ˜Ÿæ˜Ÿæ•ˆæœ (stars)
    â””â”€â”€ ç²’å­æ•ˆæœ (particles)

ç»“æœé¡µé¢ (result.html)
â”œâ”€â”€ é—®é¢˜å±•ç¤ºå¡ç‰‡
â”œâ”€â”€ AIæ€è€ƒè¿‡ç¨‹åŒºåŸŸï¼ˆå¯æŠ˜å ï¼‰
â”œâ”€â”€ AIç­”æ¡ˆå±•ç¤ºåŒºåŸŸï¼ˆæµå¼æ˜¾ç¤ºï¼‰
â””â”€â”€ æ“ä½œæŒ‰é’®ï¼ˆå¤åˆ¶ã€åˆ†äº«ç­‰ï¼‰
```

### JavaScriptæ¨¡å—åˆ’åˆ†

```javascript
script.js ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š
â”œâ”€â”€ åˆå§‹åŒ–æ¨¡å—
â”‚   â”œâ”€â”€ createStars() - åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
â”‚   â”œâ”€â”€ createParticles() - åˆ›å»ºç²’å­æ•ˆæœ
â”‚   â””â”€â”€ event listeners - äº‹ä»¶ç›‘å¬å™¨è®¾ç½®
â”œâ”€â”€ ä¸»é¢˜åˆ‡æ¢æ¨¡å—
â”‚   â”œâ”€â”€ switchTab() - åˆ‡æ¢ç‰©ç†/åŒ–å­¦
â”‚   â”œâ”€â”€ updateParticleTheme() - æ›´æ–°ç²’å­ä¸»é¢˜
â”‚   â””â”€â”€ æ ·å¼ç±»åˆ‡æ¢é€»è¾‘
â”œâ”€â”€ é—®é¢˜å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ handleQuestionSubmit() - å¤„ç†æäº¤
â”‚   â”œâ”€â”€ sendTextQuery() - å‘é€æ–‡æœ¬æŸ¥è¯¢
â”‚   â””â”€â”€ sendImageQuery() - å‘é€å›¾ç‰‡æŸ¥è¯¢
â”œâ”€â”€ APIé€šä¿¡æ¨¡å—
â”‚   â”œâ”€â”€ fetchè¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ EventSourceè¿æ¥ç®¡ç†
â”‚   â””â”€â”€ é”™è¯¯å¤„ç†
â””â”€â”€ UIçŠ¶æ€ç®¡ç†
    â”œâ”€â”€ showLoadingState() - æ˜¾ç¤ºåŠ è½½
    â”œâ”€â”€ hideLoadingState() - éšè—åŠ è½½
    â””â”€â”€ displayResult() - æ˜¾ç¤ºç»“æœ
```

### CSSæ¶æ„è®¾è®¡

```css
styles.css ç»„ç»‡ç»“æ„ï¼š
â”œâ”€â”€ åŸºç¡€åŠ¨ç”»å®šä¹‰
â”‚   â”œâ”€â”€ @keyframes åŠ¨ç”»
â”‚   â”œâ”€â”€ æ¸å˜èƒŒæ™¯
â”‚   â””â”€â”€ ä¸»é¢˜è‰²å½©å˜é‡
â”œâ”€â”€ å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ å¯¼èˆªæ æ ·å¼
â”‚   â”œâ”€â”€ å¡ç‰‡å¸ƒå±€
â”‚   â””â”€â”€ å“åº”å¼æ–­ç‚¹
â”œâ”€â”€ ä¸»é¢˜ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ç‰©ç†ä¸»é¢˜ï¼ˆè“è‰²ç³»ï¼‰
â”‚   â”œâ”€â”€ åŒ–å­¦ä¸»é¢˜ï¼ˆçº¢è‰²ç³»ï¼‰
â”‚   â””â”€â”€ ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»
â”œâ”€â”€ äº¤äº’æ•ˆæœ
â”‚   â”œâ”€â”€ æ‚¬åœæ•ˆæœ
â”‚   â”œâ”€â”€ ç‚¹å‡»åé¦ˆ
â”‚   â””â”€â”€ åŠ è½½åŠ¨ç”»
â””â”€â”€ ç‰¹æ•ˆç»„ä»¶
    â”œâ”€â”€ ç»ç’ƒæ‹Ÿæ€æ•ˆæœ
    â”œâ”€â”€ å‘å…‰è¾¹æ¡†
    â””â”€â”€ ç²’å­åŠ¨ç”»
```

## ğŸ”§ Flaskåç«¯æ¶æ„ç»†èŠ‚

### åº”ç”¨é…ç½®

```python
app.py æ¶æ„ï¼š
â”œâ”€â”€ åº”ç”¨åˆå§‹åŒ–
â”‚   â”œâ”€â”€ Flaskå®ä¾‹åˆ›å»º
â”‚   â”œâ”€â”€ CORSé…ç½®
â”‚   â”œâ”€â”€ é™æ€æ–‡ä»¶é…ç½®
â”‚   â””â”€â”€ OpenAIå®¢æˆ·ç«¯åˆå§‹åŒ–
â”œâ”€â”€ è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ @app.route('/') - ä¸»é¡µ
â”‚   â”œâ”€â”€ @app.route('/api/query/text') - æ–‡æœ¬æŸ¥è¯¢
â”‚   â”œâ”€â”€ @app.route('/result/<session_id>') - ç»“æœé¡µ
â”‚   â””â”€â”€ @app.route('/api/stream/<session_id>') - æµå¼å“åº”
â”œâ”€â”€ å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ allowed_file() - æ–‡ä»¶éªŒè¯
â”‚   â”œâ”€â”€ ç”Ÿæˆä¼šè¯ID
â”‚   â””â”€â”€ ä¿å­˜/åŠ è½½ä¼šè¯æ•°æ®
â””â”€â”€ é”™è¯¯å¤„ç†
    â”œâ”€â”€ å¼‚å¸¸æ•è·
    â”œâ”€â”€ é”™è¯¯æ—¥å¿—è®°å½•
    â””â”€â”€ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
```

### æ•°æ®æµè®¾è®¡

```python
è¯·æ±‚å¤„ç†æµç¨‹ï¼š
1. æ¥æ”¶å‰ç«¯è¯·æ±‚
   â†“
2. éªŒè¯è¾“å…¥æ•°æ®
   â†“
3. é€‰æ‹©åˆé€‚çš„Promptæ¨¡æ¿
   â†“
4. æ„å»ºAPIè¯·æ±‚æ¶ˆæ¯
   â†“
5. è°ƒç”¨DeepSeek API
   â†“
6. å¤„ç†APIå“åº”
   â†“
7. è¿”å›ç»“æœç»™å‰ç«¯
```

## ğŸ“Š å…³é”®è®¾è®¡æ¨¡å¼

### 1. æ¨¡å—åŒ–è®¾è®¡
- å‰åç«¯åˆ†ç¦»
- åŠŸèƒ½æ¨¡å—ç‹¬ç«‹
- æ¸…æ™°çš„æ¥å£å®šä¹‰

### 2. å¼‚æ­¥å¤„ç†
- ä½¿ç”¨async/awaitå¤„ç†å¼‚æ­¥æ“ä½œ
- æµå¼å“åº”æå‡ç”¨æˆ·ä½“éªŒ
- éé˜»å¡çš„APIè°ƒç”¨

### 3. çŠ¶æ€ç®¡ç†
- å‰ç«¯ï¼šDOMçŠ¶æ€ç®¡ç†
- åç«¯ï¼šä¼šè¯ä¸´æ—¶å­˜å‚¨
- ä¼ é€’çŠ¶æ€é€šè¿‡URLå‚æ•°

### 4. é”™è¯¯å¤„ç†
- å‰ç«¯ï¼šç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- åç«¯ï¼šå¼‚å¸¸æ•è·å’Œæ—¥å¿—è®°å½•
- APIï¼šç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ
```
Python Flaskå¼€å‘æœåŠ¡å™¨
â”œâ”€â”€ Debugæ¨¡å¼å¼€å¯
â”œâ”€â”€ è‡ªåŠ¨é‡è½½
â”œâ”€â”€ è¯¦ç»†é”™è¯¯ä¿¡æ¯
â””â”€â”€ ç«¯å£ï¼š5000
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆå»ºè®®ï¼‰
```
éƒ¨ç½²æ–¹æ¡ˆï¼š
â”œâ”€â”€ Gunicorn/uWSGI - WSGIæœåŠ¡å™¨
â”œâ”€â”€ Nginx - åå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡
â”œâ”€â”€ Redis - ä¼šè¯å­˜å‚¨ï¼ˆæ›¿ä»£æ–‡ä»¶å­˜å‚¨ï¼‰
â””â”€â”€ SSLè¯ä¹¦ - HTTPSæ”¯æŒ
```

## ğŸ’¡ å­¦ä¹ è¦ç‚¹

ä½œä¸ºç¼–ç¨‹åˆå­¦è€…ï¼Œè¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†ï¼š

1. **å‰åç«¯äº¤äº’**ï¼šç†è§£HTTPè¯·æ±‚å’Œå“åº”
2. **å¼‚æ­¥ç¼–ç¨‹**ï¼šasync/awaitå’ŒPromiseçš„ä½¿ç”¨
3. **DOMæ“ä½œ**ï¼šJavaScriptå¦‚ä½•æ“ä½œç½‘é¡µå…ƒç´ 
4. **APIé›†æˆ**ï¼šå¦‚ä½•è°ƒç”¨ç¬¬ä¸‰æ–¹AIæœåŠ¡
5. **æµå¼æ•°æ®**ï¼šServer-Sent Eventså®ç°å®æ—¶æ›´æ–°
6. **CSSåŠ¨ç”»**ï¼šåˆ›å»ºå¸å¼•äººçš„ç”¨æˆ·ç•Œé¢
7. **Flaskæ¡†æ¶**ï¼šPython Webå¼€å‘åŸºç¡€

## ğŸ” ä»£ç ç¤ºä¾‹ç†è§£

### ç®€å•çš„å‰åç«¯äº¤äº’ç¤ºä¾‹ï¼š

```javascript
// å‰ç«¯å‘é€è¯·æ±‚
fetch('/api/ask', {
    method: 'POST',
    body: JSON.stringify({question: "1+1=?"})
})
.then(response => response.json())
.then(data => console.log(data.answer)); // è¾“å‡ºï¼š2
```

```python
# åç«¯å¤„ç†è¯·æ±‚
@app.route('/api/ask', methods=['POST'])
def ask_question():
    data = request.get_json()
    question = data['question']
    answer = calculate_answer(question)
    return jsonify({'answer': answer})
```

è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å…¨æ ˆå¼€å‘å­¦ä¹ æ¡ˆä¾‹ï¼Œæ¶µç›–äº†å‰ç«¯ã€åç«¯ã€APIé›†æˆç­‰å¤šä¸ªé‡è¦æ¦‚å¿µã€‚